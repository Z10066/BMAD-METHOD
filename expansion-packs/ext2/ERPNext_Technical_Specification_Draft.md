# ERPNext 技術規範

## 1. はじめに

このドキュメントは、ERPNextの技術的な側面を包括的に説明することを目的としています。システムアーキテクチャ、技術スタック、開発規範、デプロイガイド、およびセキュリティに関するベストプラクティスを網羅します。

## 2. システムアーキテクチャ

ERPNextは、Frappe Framework上に構築されており、堅牢でスケーラブルなビジネスアプリケーションの開発を可能にします。そのアーキテクチャは、以下の主要な特徴を持っています。

### 2.1. Frappe Framework

Frappe Frameworkは、PythonベースのフルスタックWebアプリケーションフレームワークであり、データベース集約型のビジネスアプリケーションを迅速に開発するために設計されています。メタデータ駆動型のアプローチを採用しており、最小限のコーディングで機能豊富なアプリケーションを構築できます。

### 2.2. MVCSアーキテクチャ

ERPNextは、Model-View-Controller-Service (MVCS) アーキテクチャを採用しています。これにより、データ、ビジネスロジック、ユーザーインターフェースが明確に分離され、システムの保守性と拡張性が向上しています。

### 2.3. 3層アーキテクチャ

ERPNextは、以下の3つの主要な層で構成される3層アーキテクチャを採用しています。

- **データベース層**: すべてのビジネスデータが保存されます。主にMariaDBが使用されます。
- **アプリケーションサーバー層**: PythonベースのFrappeアプリケーションサーバーがビジネスロジックを処理し、データベースとWebフロントエンド間の通信を管理します。
- **Webフロントエンド層**: ユーザーインターフェースを提供し、ユーザーがシステムと対話できるようにします。主にJavaScript、HTML5、CSS3が使用されます。

### 2.4. モノリシックアーキテクチャ

ERPNextはモノリシックアーキテクチャを採用しており、すべてのコンポーネントが単一のアプリケーションとしてデプロイされます。これにより、開発とデプロイの複雑さが軽減され、小規模から中規模のデプロイメントにおいて高いパフォーマンスとスケーラビリティを実現します。

## 3. 技術スタック

ERPNextは、以下の主要な技術で構成されています。

- **プログラミング言語**: Python (バックエンドロジック), JavaScript (フロントエンド、クライアントサイドスクリプト)
- **データベース**: MariaDB (デフォルト)
- **Webフレームワーク**: Frappe Framework (Python)
- **フロントエンド技術**: HTML5, CSS3, Bootstrap (レスポンシブデザイン), Jinja (テンプレートエンジン), Socket.io (リアルタイム通信)
- **Webサーバー**: Gunicorn (Python WSGI HTTP Server)
- **その他**: Node.js (ビルドツール、一部のユーティリティ), Redis (キャッシュ、キュー)

## 4. 開発規範

ERPNextの開発においては、以下の規範とベストプラクティスに従うことが推奨されます。

### 4.1. バージョン管理

- **Gitの利用**: すべてのコード変更はGitを使用してバージョン管理を行うべきです。
- **頻繁なコミットとリベース**: 小さな変更ごとに頻繁にコミットし、上流のリポジトリと定期的にリベースすることで、コンフリクトを最小限に抑え、コードの整合性を保ちます。

### 4.2. コードの変更

- **Frappe/ERPNextコアコードの変更を避ける**: コアシステムファイルを直接変更することは避けるべきです。これにより、将来のアップグレードが容易になり、システムの安定性が保たれます。
- **カスタムアプリの利用**: カスタマイズは、新しいDoctypeの作成や既存のDoctypeへのカスタムフィールドの追加など、カスタムアプリを通じて行うべきです。これにより、カスタマイズがコアシステムから分離され、管理が容易になります。

### 4.3. 開発環境と本番環境

- **環境の分離**: 開発環境と本番環境は明確に分離し、異なる設定とデータを使用すべきです。これにより、開発中の変更が本番システムに影響を与えることを防ぎます。

### 4.4. カスタマイズのベストプラクティス

- **新しいDoctypeの作成**: 独自のビジネス要件に対応するために、新しいDoctypeを作成することを検討します。
- **カスタムフィールドの命名規則**: カスタムフィールドには、明確で一貫性のある命名規則を使用します。
- **コア機能の変更を避ける**: 可能な限り、既存のコア機能を変更するのではなく、拡張機能やフックを利用して機能を追加します。
- **カスタムアプリのインストール**: カスタマイズは、専用のカスタムアプリとしてパッケージ化し、インストールすることで、管理とデプロイを簡素化します。

### 4.5. テストのベストプラクティス

- **自動化されたテストツールの利用**: テストの効率と信頼性を高めるために、自動化されたテストツールを積極的に利用します。
- **テストフレームワークの理解**: Frappe Frameworkが提供するテストフレームワークを理解し、適切に利用することで、品質の高いコードを維持します。

### 4.6. セキュリティのベストプラクティス

- **定期的なシステムと依存関係の更新**: ERPNextインスタンスとすべての依存関係（OS、データベース、Pythonなど）を定期的に最新の状態に保ち、既知の脆弱性から保護します。
- **安全なホスティングプロバイダの利用**: 信頼できる安全なホスティングプロバイダを選択し、適切なネットワークセキュリティ対策（ファイアウォール、IDS/IPSなど）を講じます。
- **データセキュリティとコンプライアンス**: データの暗号化、アクセス制御、監査ログの有効化など、データセキュリティと関連する規制（GDPR、HIPAAなど）への準拠を確保します。

## 5. デプロイガイド

ERPNextのデプロイは、いくつかの方法で行うことができます。ここでは、一般的なデプロイ方法と考慮事項について説明します。

### 5.1. デプロイ方法

- **Ubuntuへのデプロイ**: 最も一般的なデプロイ方法の一つであり、Frappe Benchを使用して手動でインストールおよび設定を行います。
- **Dockerコンテナでのデプロイ**: DockerとDocker Composeを使用して、コンテナ化された環境にERPNextをデプロイします。これにより、環境の再現性とスケーラビリティが向上します。

### 5.2. デプロイの考慮事項

- **Frappe Benchの利用**: Frappe Benchは、ERPNextおよびFrappe Frameworkアプリケーションの管理ツールであり、インストール、アップグレード、サイト管理、バックアップなどのタスクを簡素化します。
- **MariaDBの設定**: データベースとしてMariaDBを使用する場合、適切な設定（文字セット、ストレージエンジン、パフォーマンスチューニングなど）を行うことが重要です。
- **システムの更新とアップグレード**: 定期的にシステムとERPNextインスタンスを更新し、最新の機能、バグ修正、セキュリティパッチを適用します。
- **バックアップとリカバリ**: 定期的なデータバックアップ戦略を確立し、災害発生時に迅速にシステムをリカバリできることを確認します。

## 6. まとめ

ERPNextは、強力なFrappe Framework上に構築されたオープンソースのERPソリューションであり、柔軟なアーキテクチャと豊富な技術スタックを提供します。この技術規範が、ERPNextの理解と効果的な利用に役立つことを願っています。
